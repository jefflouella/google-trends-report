<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>{{ title }}</title>
    <style>
      :root {
        --fg: #111;
        --muted: #666;
        --border: #e6e6e6;
        --bg-soft: #fafafa;
        --code-bg: #f3f3f3;
        --accent: #2563eb;
        --accent-soft: #eff6ff;
      }
      body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 28px; line-height: 1.45; color: var(--fg); }
      h1, h2, h3 { line-height: 1.2; }
      .muted { color: var(--muted); }
      .card { border: 1px solid var(--border); border-radius: 12px; padding: 16px; background: #fff; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 14px; max-width: 1040px; }
      .kv { display: flex; flex-wrap: wrap; gap: 10px 18px; }
      .kv div { white-space: nowrap; }
      code { background: var(--code-bg); padding: 2px 6px; border-radius: 6px; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border-bottom: 1px solid var(--border); padding: 8px 10px; text-align: left; }
      th { background: var(--bg-soft); }
      .section { margin-top: 22px; }
      .tabbar { display: flex; flex-wrap: wrap; gap: 10px; }
      .tabbtn { border: 1px solid var(--border); background: var(--bg-soft); padding: 8px 12px; border-radius: 10px; cursor: pointer; }
      .tabbtn:hover { border-color: #cbd5e1; background: #fff; }
      .tabbtn.active { background: var(--accent-soft); border-color: var(--accent); color: var(--accent); font-weight: 600; }
      .tabpanel { display: none; }
      .tabpanel.active { display: block; }
    </style>
    {{ plotly_js_tag | safe }}
  </head>
  <body>
    <div class="grid">
      <div>
        <h1>{{ heading }}</h1>
        <p class="muted">{{ subtitle }}</p>
      </div>

      <div class="card kv">
        <div><b>Main:</b> {{ params.main }}</div>
        <div><b>Geo:</b> <code>{{ params.geo }}</code></div>
        <div><b>Timeframe:</b> <code>{{ params.timeframe }}</code></div>
        <div><b>Report:</b> <code>{{ params.report_type }}</code></div>
        {% if params.gprop %}
        <div><b>Property:</b> <code>{{ params.gprop }}</code></div>
        {% endif %}
        <div><b>AI:</b> <code>{{ params.ai }}</code></div>
      </div>

      {% if tabs and tabs|length > 0 %}
      <div class="card section">
        <h2>Views</h2>
        <div class="tabbar" role="tablist" aria-label="Report views">
          {% for tab in tabs %}
          <button class="tabbtn{% if loop.first %} active{% endif %}" role="tab" type="button" data-tab="{{ tab.id }}" aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
            {{ tab.title }}
          </button>
          {% endfor %}
        </div>
      </div>

      {% for tab in tabs %}
      <div class="tabpanel{% if loop.first %} active{% endif %}" data-tabpanel="{{ tab.id }}" role="tabpanel">
        {% for section in tab.sections %}
        <div class="card section">
          <h2>{{ section.title }}</h2>
          {% if section.commentary %}
            <div class="muted">{{ section.commentary | safe }}</div>
          {% endif %}
          {% if section.html %}
            <div>{{ section.html | safe }}</div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% endfor %}
      {% else %}
      {% for section in sections %}
      <div class="card section">
        <h2>{{ section.title }}</h2>
        {% if section.commentary %}
          <div class="muted">{{ section.commentary | safe }}</div>
        {% endif %}
        {% if section.html %}
          <div>{{ section.html | safe }}</div>
        {% endif %}
      </div>
      {% endfor %}
      {% endif %}

      <div class="muted">
        <p><b>Methodology note:</b> Google Trends values are indexed/normalized (0â€“100) relative to the chosen time range and query set; comparisons across separate queries require rescaling.</p>
      </div>
    </div>
    <script>
      (function () {
        function setActive(tabId) {
          document.querySelectorAll('.tabbtn').forEach(function (b) {
            var on = b.getAttribute('data-tab') === tabId;
            b.classList.toggle('active', on);
            b.setAttribute('aria-selected', on ? 'true' : 'false');
          });
          document.querySelectorAll('.tabpanel').forEach(function (p) {
            p.classList.toggle('active', p.getAttribute('data-tabpanel') === tabId);
          });

          // Plotly charts may need a resize after being revealed.
          if (window.Plotly && window.Plotly.Plots) {
            window.setTimeout(function () {
              var panel = document.querySelector('.tabpanel.active');
              if (!panel) return;
              panel.querySelectorAll('.plotly-graph-div').forEach(function (el) {
                try { window.Plotly.Plots.resize(el); } catch (e) {}
              });
            }, 30);
          }
        }

        document.querySelectorAll('.tabbtn').forEach(function (b) {
          b.addEventListener('click', function () {
            setActive(b.getAttribute('data-tab'));
          });
        });
      })();
    </script>
  </body>
</html>


